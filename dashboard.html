<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard | Academic Timetable Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css?family=Inter:400,600,700&display=swap" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <style>
    body, .font-sans { font-family: 'Inter', Arial, Helvetica, sans-serif !important; }
    .floating-container {
      background: rgba(255,255,255,0.96);
      box-shadow: 0 10px 34px 14px rgba(79,70,229,0.08);
      border-radius: 1.5rem;
      margin: 2rem auto;
      max-width: 800px;
      padding: 2rem;
    }
    .menu-btn {
      cursor: pointer;
      display: inline-flex; align-items: center; justify-content: center;
      background: #6366f1;
      width: 2.7rem; height: 2.7rem;
      border-radius: 999px;
      color: #fff;
      font-size: 1.30rem;
      border: none;
      outline: none;
      transition: background .18s;
    }
    .menu-btn:hover { background: #4f46e5; }
    .menu-dropdown {
      position: absolute;
      right: 0.9rem; top: 3.8rem; min-width: 170px;
      background: #fff;
      border-radius: 0.85rem;
      box-shadow: 0 4px 18px 0 rgba(80,67,181,0.13);
      z-index: 30;
      padding: 0.7rem 0;
      display: none;
    }
    .menu-dropdown.active { display: block; }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-100 via-blue-50 to-indigo-200 min-h-screen flex flex-col items-center font-sans">

  <div class="floating-container relative">

    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <span class="text-indigo-700 font-bold text-2xl">Dashboard</span>
      <div class="relative flex items-center">
        <!-- User Icon Button -->
        <button id="userMenuBtn" class="menu-btn" title="User Menu">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="2 2 20 20" stroke="currentColor" width="28" height="28">
            <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="1.5" fill="#e0e7ff"/>
            <ellipse cx="12" cy="17" rx="7" ry="5" stroke="currentColor" stroke-width="1.5" fill="#e0e7ff"/>
          </svg>
        </button>
        <!-- Dropdown Menu -->
        <div id="userMenuDropdown" class="menu-dropdown shadow-xl">
          <div class="px-5 py-2 text-indigo-800 font-semibold text-sm border-b border-indigo-100 mb-1 text-center">
            <span id="userMenuName">User</span>
            <div class="text-xs text-gray-500 font-normal" id="userMenuEmail"></div>
          </div>
          <button id="addAccountBtn" class="w-full text-left px-5 py-2 text-sm hover:bg-indigo-50 transition">âž• Add Account</button>
          <button id="switchAccountBtn" class="w-full text-left px-5 py-2 text-sm hover:bg-indigo-50 transition">ðŸ”„ Switch Account</button>
          <button id="logoutBtn" class="w-full text-left px-5 py-2 text-sm text-red-600 hover:bg-red-50 transition">ðŸšª Logout</button>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <h2 class="text-indigo-800 text-xl font-semibold mb-2">Welcome, <span id="dashboardUserName">loading...</span>!</h2>
    <div class="mb-7 text-gray-600">This is your dashboard. Add your timetable and project features below.</div>

    <div id="dashMsg" class="mt-4 text-center text-sm font-medium"></div>

    <!-- (Put your other project functionalities/components here) -->
    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-7">
      <div class="rounded-xl bg-indigo-50 shadow p-6 flex flex-col justify-between">
        <div>
          <div class="font-bold text-indigo-700 text-lg mb-2">Timetable Overview</div>
          <p class="text-gray-700 text-sm">Show students/classes/teachers timetable summary here.</p>
        </div>
        <button class="mt-4 px-4 py-2 bg-indigo-600 text-white text-sm font-semibold rounded shadow hover:bg-indigo-800">View Timetables</button>
      </div>
      <div class="rounded-xl bg-indigo-50 shadow p-6 flex flex-col justify-between">
        <div>
          <div class="font-bold text-indigo-700 text-lg mb-2">Teacher Management</div>
          <p class="text-gray-700 text-sm">List/add teachers with workload, roles, and allocation settings.</p>
        </div>
        <button class="mt-4 px-4 py-2 bg-indigo-600 text-white text-sm font-semibold rounded shadow hover:bg-indigo-800">Add/Manage Teachers</button>
      </div>
      <!-- You can duplicate and add more blocks for Labs, Subjects, Reports, etc. -->
    </div>
  </div>

  <!-- Add Account Modal -->
  <div id="modalBg" class="modal-bg hidden">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-8 relative">
      <button id="closeModalBtn" class="absolute top-3 right-4 text-gray-400 text-2xl hover:text-indigo-600">&times;</button>
      <h3 class="text-indigo-700 text-xl font-semibold mb-5">Add New Account</h3>
      <form id="modalRegisterForm" class="space-y-4">
        <input type="text" id="modalName" placeholder="Full Name" class="w-full border rounded px-4 py-2" required />
        <input type="email" id="modalEmail" placeholder="Email" class="w-full border rounded px-4 py-2" required />
        <input type="password" id="modalPassword" placeholder="Password" minlength="6" class="w-full border rounded px-4 py-2" required />
        <select id="modalRole" class="w-full border rounded px-4 py-2" required>
          <option value="">Select role</option>
          <option value="Admin/HOD">Admin/HOD</option>
          <option value="Teacher">Teacher</option>
          <option value="Student">Student</option>
        </select>
        <button type="submit" class="w-full bg-indigo-700 hover:bg-indigo-900 text-white font-semibold rounded py-2 transition">
          Register Account
        </button>
      </form>
      <div id="modalRegisterMsg" class="mt-3 text-center text-sm font-medium"></div>
    </div>
  </div>

  <script>
    // Initialize Firebase (replace config if needed)
    const firebaseConfig = {
      apiKey: "AIzaSyDNO1ASD3GOeFhr-GWAbkKGZ5KrSm32ZTE",
      authDomain: "time-52b7e.firebaseapp.com",
      projectId: "time-52b7e",
      storageBucket: "time-52b7e.appspot.com",
      messagingSenderId: "340938054755",
      appId: "1:340938054755:web:99c98398dd166ed1422c56"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Auth check and fill user info
    function setUserNameFields(user) {
      document.getElementById("dashboardUserName").textContent = user.displayName || user.email;
      document.getElementById("userMenuName").textContent = user.displayName || "User";
      document.getElementById("userMenuEmail").textContent = user.email;
    }
    auth.onAuthStateChanged(user => {
      if (!user) window.location.href = "login-register.html";
      else setUserNameFields(user);
    });

    // User Menu dropdown logic
    const userMenuBtn = document.getElementById("userMenuBtn");
    const userMenuDropdown = document.getElementById("userMenuDropdown");
    let menuOpen = false;
    userMenuBtn.onclick = e => {
      menuOpen = !menuOpen;
      userMenuDropdown.classList.toggle("active", menuOpen);
      e.stopPropagation();
    };
    document.body.onclick = () => {
      if (menuOpen) {
        userMenuDropdown.classList.remove("active");
        menuOpen = false;
      }
    };
    userMenuDropdown.onclick = e => e.stopPropagation();

    // Add Account modal open/close logic
    const modalBg = document.getElementById("modalBg");
    document.getElementById("addAccountBtn").onclick = () => {
      modalBg.classList.remove("hidden");
      document.getElementById("modalRegisterMsg").textContent = "";
      document.getElementById("modalRegisterForm").reset();
      userMenuDropdown.classList.remove("active");
      menuOpen = false;
    };
    document.getElementById("closeModalBtn").onclick = () => { modalBg.classList.add("hidden"); };
    modalBg.onclick = e => { if (e.target === modalBg) modalBg.classList.add("hidden"); };

    // Modal Register Handler
    document.getElementById("modalRegisterForm").addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("modalName").value.trim();
      const email = document.getElementById("modalEmail").value.trim();
      const password = document.getElementById("modalPassword").value;
      const role = document.getElementById("modalRole").value;
      const msgElem = document.getElementById("modalRegisterMsg");
      msgElem.textContent = "";
      if (!role) {
        msgElem.innerHTML = "<span class='text-red-600'>Please select a role.</span>";
        return;
      }
      firebase.auth().createUserWithEmailAndPassword(email, password)
        .then(userCredential => userCredential.user.updateProfile({ displayName: name }))
        .then(() => {
          msgElem.innerHTML = "<span class='text-green-700'>Account created successfully!</span>";
          setTimeout(() => modalBg.classList.add("hidden"), 1400);
        })
        .catch(error => { msgElem.innerHTML = `<span class='text-red-600'>${error.message}</span>`; });
    });

    // Logout + Switch Account
    document.getElementById("logoutBtn").onclick = () => {
      auth.signOut().then(() => {
        document.getElementById("dashMsg").textContent = "Logged out!";
        setTimeout(() => window.location.href = "login-register.html", 900);
      }).catch(e => { document.getElementById("dashMsg").textContent = e.message; });
    };
    document.getElementById("switchAccountBtn").onclick = () => {
      auth.signOut().then(() => window.location.href = "login-register.html")
      .catch(e => { document.getElementById("dashMsg").textContent = e.message; });
    };
  </script>
</body>
</html>
